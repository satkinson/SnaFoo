
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content" role="main">
    <div class="shelf shelf_5">
        <h2 class="hdg hdg_1">Suggestions</h1>
    </div>
    <div class="shelf shelf_2">
        <div class="error isHidden">
            You have attempted to add more than the allowed number of suggestions per month!
            <br />There is a total of three allowed suggestions per month.
        </div>
        <div class="error isHidden">You have attempted to add a suggestion that already exists!</div>
        <div class="error isHidden">You have not completed information requested.</div>
    </div>
    <div class="content-centered">
        <div class="shelf shelf_2">
            <form method="" action="" class="form" novalidate>
                <fieldset class="shelf shelf_2">
                    <div class="shelf shelf_2">
                        <div class="shelf">
                            <label for="snackOptions">
                                <h2 class="hdg hdg_2">Select a snack from the list</h2>
                            </label>
                        </div>

                        <select name="snackOptions" id="snackOptions" data-bind="
                                options: snackOptions,
                                optionsText: 'name',
                                value: id,
                                optionsCaption: 'Choose a Snack...'
                                 ">
                        </select>
                    </div>
                </fieldset>
                <div class="shelf shelf_5">
                    <p class="hdg hdg_1">or</p>
                </div>
                <fieldset class="shelf shelf_5">
                    <div class="shelf">
                        <label for="suggestionInput">
                            <h2 class="hdg hdg_2">Enter new snack suggestion &amp; purchasing location</h2>
                        </label>
                    </div>
                    <div class="shelf">
                        <input type="text" id="suggestionInput" placeholder="Snack Suggestion" />
                    </div>
                    <div class="shelf">
                        <label for="suggestionLocation" class="isHidden">Location</label>
                        <input type="text" id="suggestionLocation" placeholder="Location" class="" />
                    </div>
                </fieldset>
                <input type="submit" value="Suggest this Snack!" class="btn">
            </form>
        </div>
    </div>
</div>

@section scripts {
    <script type="text/javascript">
        $.getJSON("https://api-snacks.nerderylabs.com/v1/snacks?ApiKey=da39f072-4eaa-43ef-abd0-9c6c51a7cdb2", function (data) {
            console.log('data loaded : ', data);

            var model = {
                snackOptions: ko.observableArray([])
            };

            for (var i = 0; i < data.length; i++) {
                if (data[i].optional) { //TODO : remove snacks already suggested for the next month
                    model.snackOptions.push(data[i]);
                }
            }

            ko.applyBindings(model);
        })
    </script>
}

